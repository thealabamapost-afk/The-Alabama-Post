<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>The Alabama Post | Alabama Reflector Feed</title>

<meta property="og:title" content="The Alabama Post | From the Alabama Reflector">
<meta property="og:description" content="Latest news from The Alabama Reflector, updated live on The Alabama Post.">
<meta property="og:image" content="https://alabamareflector.com/wp-content/uploads/2023/07/Alabama-Reflector-logo.png">

<style>
body {
  font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
  background: #f9fafb;
  color: #111827;
  margin: 0;
  padding: 0;
  text-align: center;
}
header {
  background: #111827;
  color: white;
  padding: 30px 0 25px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.2);
}
header h1 {
  margin: 0;
  font-size: 2.4rem;
  color: #f97316;
}
header p {
  color: #d1d5db;
  margin: 8px 0 0;
}
h2 {
  color: #b91c1c;
  font-size: 2rem;
  margin-top: 40px;
  display: inline-block;
  border-bottom: 4px solid #b91c1c;
  padding-bottom: 6px;
}
#reflectorFeed {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 30px;
  padding: 40px 20px;
}
.reflector-article {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  width: 320px;
  overflow: hidden;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  text-align: left;
}
.reflector-article:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 18px rgba(0,0,0,0.15);
}
.reflector-article img {
  width: 100%;
  height: 200px;
  object-fit: cover;
  border-bottom: 3px solid #b91c1c;
  background: #f3f3f3;
}
.reflector-article-content {
  padding: 18px 20px 25px;
}
.reflector-article-content a {
  color: #b91c1c;
  font-weight: 700;
  text-decoration: none;
  font-size: 1.2rem;
  display: block;
  margin-bottom: 8px;
}
.reflector-article-content a:hover {
  text-decoration: underline;
}
.reflector-article-content p {
  color: #374151;
  font-size: 0.98rem;
  line-height: 1.6;
}
.credit {
  font-size: 0.85rem;
  color: #6b7280;
  margin-top: 10px;
}
#loadingSpinner {
  display: none;
  font-size: 1rem;
  color: #b91c1c;
}
#lastUpdated {
  color: #555;
  font-size: 0.95rem;
  margin-bottom: 20px;
}
.more-btn {
  background: #b91c1c;
  color: white;
  text-decoration: none;
  padding: 12px 26px;
  border-radius: 8px;
  font-weight: 600;
  display: inline-block;
  transition: background 0.25s ease;
  margin-bottom: 50px;
}
.more-btn:hover {
  background: #991b1b;
}
footer {
  text-align: center;
  color: #9ca3af;
  font-size: 0.9rem;
  background: #111827;
  padding: 20px 0;
}
</style>
</head>
<body>
<header>
  <h1>The Alabama Post</h1>
  <p>Independent • Honest • Fearless Journalism</p>
</header>

<h2>From the Alabama Reflector</h2>
<p id="lastUpdated">Loading latest update…</p>
<div id="loadingSpinner">Loading...</div>
<div id="reflectorFeed"></div>
<a href="https://alabamareflector.com" target="_blank" class="more-btn">View More from Alabama Reflector →</a>

<footer>
  © 2025 The Alabama Post | Decatur, Alabama | “Where Truth Meets Independence”
</footer>

<script>
const FALLBACK_IMAGE = "https://alabamareflector.com/wp-content/uploads/2023/07/Alabama-Reflector-logo.png";
const feed = document.getElementById("reflectorFeed");
const spinner = document.getElementById("loadingSpinner");
const updated = document.getElementById("lastUpdated");

// ✅ Auto-detect correct JSON path even on GitHub Pages
const BASE_PATH = window.location.pathname.replace(/\/[^/]*$/, '');
const FEED_URL = `${BASE_PATH}/reflector.json`;

function extractImage(html) {
  const match = html.match(/<img[^>]+src="([^"]+)"/);
  return match ? match[1] : FALLBACK_IMAGE;
}

async function loadFeed() {
  spinner.style.display = "inline-block";
  feed.innerHTML = "";
  try {
    const res = await fetch(FEED_URL, { cache: "no-store" });
    if (!res.ok) throw new Error("Bad response");
    const data = await res.json();
    spinner.style.display = "none";

    if (!data.items || !data.items.length) {
      feed.innerHTML = "<p>No articles found.</p>";
      return;
    }

    data.items.slice(0, 8).forEach(item => {
      const image = item.thumbnail || extractImage(item.content || "") || FALLBACK_IMAGE;
      const cleanDesc = item.description
        ? item.description.replace(/<[^>]*>?/gm, "").substring(0, 250)
        : "";
      const card = document.createElement("div");
      card.classList.add("reflector-article");
      card.innerHTML = `
        <img src="${image}" alt="Article Image" loading="lazy" onerror="this.src='${FALLBACK_IMAGE}'" />
        <div class="reflector-article-content">
          <a href="${item.link}" target="_blank">${item.title}</a>
          <p>${cleanDesc}...</p>
          <p class="credit">Source: <a href="https://alabamareflector.com" target="_blank">Alabama Reflector</a></p>
        </div>`;
      feed.appendChild(card);
    });

    updated.textContent =
      "Last Updated: " +
      new Date().toLocaleString("en-US", { dateStyle: "long", timeStyle: "short" });
  } catch (err) {
    spinner.style.display = "none";
    feed.innerHTML = "<p>Failed to load feed.</p>";
    console.error("Error loading feed:", err);
  }
}
loadFeed();
</script>
</body>
</html>
