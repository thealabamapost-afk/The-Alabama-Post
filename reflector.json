import fs from "fs";
import fetch from "node-fetch";

const OUTPUT_FILE = "reflector.json";
const FEED_URL =
  "https://api.rss2json.com/v1/api.json?rss_url=https://alabamareflector.com/feed/";

async function updateReflector() {
  console.log("üì° Fetching latest posts from Alabama Reflector via RSS‚Ä¶");

  try {
    const res = await fetch(FEED_URL);
    if (!res.ok) throw new Error(`Failed to fetch RSS feed: ${res.status}`);
    const data = await res.json();

    if (!data.items || data.items.length === 0) {
      throw new Error("No items found in the RSS feed.");
    }

    const items = data.items.slice(0, 9).map(item => ({
      title: item.title,
      link: item.link,
      thumbnail: item.thumbnail || "",
      description: item.description || "",
    }));

    const output = {
      status: "ok",
      feed: {
        title: data.feed.title,
        link: data.feed.link,
        description: data.feed.description,
        image: data.feed.image,
      },
      items,
    };

    fs.writeFileSync(OUTPUT_FILE, JSON.stringify(output, null, 2));
    console.log("‚úÖ reflector.json updated successfully!");
  } catch (err) {
    console.error("‚ùå Error updating reflector.json:", err.message);
    process.exit(1);
  }
}

updateReflector();
